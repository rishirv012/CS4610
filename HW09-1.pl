/*ADDED FEATURE: 
 * You can pickup a sword in the maze and use it to kill the ogre.
 * if you come face to face with the ogre while holding the sword you kill it rather
 * than dying
*/
/* 
---RUN THROUGH #1---
This is an adventure game.
Legal moves are (l)eft, (r)ight, or (f)orward.

You currently are holding nothing
You are in a pleasant valley, with a trail ahead.
Next move --
f
---- Moving forward ----
You currently are holding nothing
You are on a path, with ravines on both sides.
Next move --
f
---- Moving forward ----
You currently are holding nothing
You are at a fork in the path.
Next move --
l
---- Moving left ----
You currently are holding nothing
You are in a maze of twisty trails, all alike.
Next move --
l
---- Moving left ----
There is a sword here. (p)ickup
You currently are holding nothing
You are in a maze of twisty trails, all alike.
Next move --
p
---- Picking Up sword ----
You are currently holding a sword. (d)rop
You are in a maze of twisty trails, all alike.
Next move --
l
---- Moving left ----
You are currently holding a sword. (d)rop
You are in a maze of twisty trails, all alike.
Next move --
r
---- Moving right ----
You come face-to-face with a horrible, angry ogre.
You slay it with your sword.
You are currently holding a sword. (d)rop
You are in a maze of twisty trails, all alike.
Next move --
d
---- dropping sword ----
There is a sword here. (p)ickup
You currently are holding nothing
You are in a maze of twisty trails, all alike.
Next move --
l
---- Moving left ----
You currently are holding nothing
You are in a maze of twisty trails, all alike.
Next move --
r
---- Moving right ----
There is a sword here. (p)ickup
You currently are holding nothing
You are in a maze of twisty trails, all alike.
Next move --
r
---- Moving right ----
There is a sword here. (p)ickup
You currently are holding nothing
You are in a maze of twisty trails, all alike.
Next move --
r
---- Moving right ----
There is a sword here. (p)ickup
You currently are holding nothing
You are in a maze of twisty trails, all alike.
Next move --
l
---- Moving left ----
You currently are holding nothing
You are in a maze of twisty trails, all alike.
Next move --
l
---- Moving left ----
You currently are holding nothing
You are in a maze of twisty trails, all alike.
Next move --
r
---- Moving right ----
There is a key here. (p)ickup
You currently are holding nothing
You are in a maze of twisty trails, all alike.
Next move --
p
---- Picking Up key ----
You are currently holding a key. (d)rop
You are in a maze of twisty trails, all alike.
Next move --
l
---- Moving left ----
You are currently holding a key. (d)rop
You are at a fork in the path.
Next move --
r
---- Moving right ----
You must unlock the gate. (u)nlock
You are currently holding a key. (d)rop
You are standing infront of a gate.
Next move --
u
***unlocking gate***
You are currently holding a key. (d)rop
You are standing infront of an unlocked gate.
Next move --
d
---- dropping key ----
There is a key here. (p)ickup
You currently are holding nothing
You are standing infront of an unlocked gate.
Next move --
p
---- Picking Up key ----
You are currently holding a key. (d)rop
You are standing infront of an unlocked gate.
Next move --
d
---- dropping key ----
There is a key here. (p)ickup
You currently are holding nothing
You are standing infront of an unlocked gate.
Next move --
f
---- Moving forward ----
There is a treasure here.
Congratulations, you win!
Thanks for playing.
1true

---RUN THROUGH #2---

This is an adventure game.
Legal moves are (l)eft, (r)ight, or (f)orward.

You currently are holding nothing
You are in a pleasant valley, with a trail ahead.
Next move --
f
---- Moving forward ----
You currently are holding nothing
You are on a path, with ravines on both sides.
Next move --
f
---- Moving forward ----
You currently are holding nothing
You are at a fork in the path.
Next move --
l
---- Moving left ----
You currently are holding nothing
You are in a maze of twisty trails, all alike.
Next move --
r
---- Moving right ----
You come face-to-face with a horrible, angry ogre.
The ogre kills you. Your story ends here.
Thanks for playing.
1true


---RUN THROUGH #3---
This is an adventure game.
Legal moves are (l)eft, (r)ight, or (f)orward.

You currently are holding nothing
You are in a pleasant valley, with a trail ahead.
Next move --
f
---- Moving forward ----
You currently are holding nothing
You are on a path, with ravines on both sides.
Next move --
f
---- Moving forward ----
You currently are holding nothing
You are at a fork in the path.
Next move --
l
---- Moving left ----
You currently are holding nothing
You are in a maze of twisty trails, all alike.
Next move --
l
---- Moving left ----
There is a sword here. (p)ickup
You currently are holding nothing
You are in a maze of twisty trails, all alike.
Next move --
p
---- Picking Up sword ----
You are currently holding a sword. (d)rop
You are in a maze of twisty trails, all alike.
Next move --
l
---- Moving left ----
You are currently holding a sword. (d)rop
You are in a maze of twisty trails, all alike.
Next move --
r
---- Moving right ----
You come face-to-face with a horrible, angry ogre.
You slay it with your sword.
You are currently holding a sword. (d)rop
You are in a maze of twisty trails, all alike.
Next move --
d
---- dropping sword ----
There is a sword here. (p)ickup
You currently are holding nothing
You are in a maze of twisty trails, all alike.
Next move --
l
---- Moving left ----
You currently are holding nothing
You are in a maze of twisty trails, all alike.
Next move --
r
---- Moving right ----
There is a sword here. (p)ickup
You currently are holding nothing
You are in a maze of twisty trails, all alike.
Next move --
l
---- Moving left ----
You currently are holding nothing
You are in a maze of twisty trails, all alike.
Next move --
l
---- Moving left ----
You currently are holding nothing
You are in a maze of twisty trails, all alike.
Next move --
r
---- Moving right ----
There is a key here. (p)ickup
You currently are holding nothing
You are in a maze of twisty trails, all alike.
Next move --
p
---- Picking Up key ----
You are currently holding a key. (d)rop
You are in a maze of twisty trails, all alike.
Next move --
l
---- Moving left ----
You are currently holding a key. (d)rop
You are at a fork in the path.
Next move --
r
---- Moving right ----
You must unlock the gate. (u)nlock
You are currently holding a key. (d)rop
You are standing infront of a gate.
Next move --
u
***unlocking gate***
You are currently holding a key. (d)rop
You are standing infront of an unlocked gate.
Next move --
f
---- Moving forward ----
You carried the key through the gate!!!
You have been struck by lighting
You are now dead. Game Over.
Thanks for playing.
1true
*/
/* HW09

  In class we have done a walkthrough of a simple text-based adventure
  game in Prolog. This file contains a version similar to the one built
  in class.

  Your assignment is to add the following features to this prolog 
  program:
    1.) Create a gate between the fork in the path and the mountaintop.
        The gate is a separate location; that is, the player must move
        from at(you,fork) to at(you,gate) and then to 
        at(you,mountaintop).

    2.) To move forward through the gate the player must first unlock it
        with a key.

    3.) The key is somewhere in the maze. The player must find it and
        explicitly pick it up.

    4.) After unlocking the gate, the player must put the key down. If 
        the player tries to pass through the gate while still holding 
        the key, he or she is killed by lightning. (To get the treasure,
        the player must first open the gate, then put down the key, and 
        then pass through.)

    5.) Part of your implementation should be a general way for the 
        player to pick things up, carry them, and put them down. Design 
        your solution so that it would be easy to add additional objects
        for the player to pick up and put down.

    6.) Everytime report() is called, also print out what items the 
        player is currently carrying. (or print out that they are 
        carrying no items)

    7.) Add at least one more feature to the game not already specified
        above. It can be anything that you want, large or small 
        (additional items, a moving antagonist, scoring, etc.). Describe
        what you added in your comments at the top of the file.

    8.) At the top of your file, include in your comments at least 2
        different complete interactions with your game (play it though a
        couple of different ways and copy and paste the results). We 
        need to know how to play your game and what to expect.
*/


/*
  This is a very short adventure game. There are three entities: you,
  a treasure, and an ogre.  There are six places: a valley, a path,
  a cliff, a fork (in the path), a maze, and a mountaintop. Your goal is
  to get the treasure without being killed first.
*/

/* Allow asserts and retracts for the predicate at */
:- dynamic at/2.

:- dynamic has/2.

:- dynamic near/2.

:- dynamic gateStatus/1.
    

/*
  First, text descriptions of all the locations in the game.
*/
description(valley,'You are in a pleasant valley, with a trail ahead.').
description(path,'You are on a path, with ravines on both sides.').
description(cliff,'You are teetering on the edge of a cliff.').
description(fork,'You are at a fork in the path.').
description(maze(_),'You are in a maze of twisty trails, all alike.').
description(mountaintop,'You are on the mountaintop.').
description(gate, 'You are standing infront of a gate.').
description(unlockedGate, 'You are standing infront of an unlocked gate.').
holding(key, 'You are currently holding a key. (d)rop').
holding(sword, 'You are currently holding a sword. (d)rop').
holding(nothing, 'You currently are holding nothing').



/*
  report prints the description of your current location.
*/
report :-
  at(you,X),
  has(you, O),
  description(X,Y),
  holding(O,Z),
  write(Z), nl,
  write(Y), nl.

/*
  These connect predicates establish the map. The meaning of
  connect(X,Dir,Y) is that if you are at X and you move in direction
  Dir, you get to Y.  Recognized directions are forward, right, and
  left.
*/
connect(valley,forward,path).
connect(path,right,cliff).
connect(path,left,cliff).
connect(path,forward,fork).
connect(fork,left,maze(0)).
connect(fork,right,gate).
connect(unlockedGate,forward,mountaintop).
connect(maze(0),left,maze(1)).
connect(maze(0),right,maze(3)).
connect(maze(1),left,maze(0)).
connect(maze(1),right,maze(2)).
connect(maze(2),left,fork).
connect(maze(2),right,maze(0)).
connect(maze(3),left,maze(0)).
connect(maze(3),right,maze(3)).

/*
  Shortcuts for moves.
*/
move(f) :- move(forward).
move(l) :- move(left).
move(r) :- move(right).

move(p) :- move(pickup).
move(d) :- move(drop).
move(u) :- move(unlock).
/*
  move(Dir) moves you in direction Dir, then prints the description of
  your new location.
*/
move(Dir) :-
  at(you,Loc),
  connect(Loc,Dir,Next),
  write('---- Moving '),write(Dir),write(' ----'),nl,
  retract(at(you,Loc)),
  assert(at(you,Next)),
  /*report,*/
  !.
/*pick objects that are near you, can only hold one object at a time*/
move(pickup) :-   
    has(you, nothing),
    near(you, O),
    at(O, Loc),
    retract(has(you, nothing)),
    assert(has(you, O)),
    write('---- Picking Up '),write(O),write(' ----'),nl,
    retract(near(you, O)),
    assert(near(you, nothing)),
    retract(at(O, Loc)),
     /*report,*/
    !.
/*can drop item you are carrying at any time*/
move(drop) :-
    at(you,Loc),
    not(has(you, nothing)),
    near(you,nothing), /*cannot be near an item if you are going to drop*/
    has(you, O),
    retract(has(you, O)),
    assert(has(you, nothing)),
    write('---- dropping '),write(O),write(' ----'),nl,
    retract(near(you, nothing)),
    assert(near(you, O)),   
    assert(at(O, Loc)),
     /*report,*/
    !.

move(unlock) :-
    at(you, gate),
    has(you, key),
    gateStatus(locked),
    write('***unlocking gate***'),nl,
    retract(gateStatus(locked)),
    assert(gateStatus(unlocked)),
    retract(at(you, gate)),
    assert(at(you,unlockedGate)),
     /*report,*/
    !.
    
/*
  But if the argument was not a legal direction, print an error message
  and don't move.
*/
move(X) :-
  write('"'),write(X),write('"'),write(' is not a legal move.'),nl,
  write('Legal moves are (l)eft, (r)ight, or (f)orward.'),nl,
  report.
/*if you have the sword you kill the ogre*/
ogre :-
  at(ogre,Loc),
  at(you,Loc),
  has(you, sword),
  write('You come face-to-face with a horrible, angry ogre.'),nl,
  write('You slay it with your sword.'),nl,
  retract(at(ogre,Loc)),
  !.
/*
  If you and the ogre are at the same place, it kills you.
*/
ogre :-
  at(ogre,Loc),
  at(you,Loc),
  write('You come face-to-face with a horrible, angry ogre.'),nl,
  write('The ogre kills you. Your story ends here.'),nl,
  retract(at(you,Loc)),
  assert(at(you,done)),
  !.
/*
  But if you and the ogre are not in the same place, nothing happens.
*/
ogre.

/*
  If you and the treasure are at the same place, you win but only if you dont have the key.
*/
treasure :-
  at(treasure,Loc),
  at(you,Loc),
  has(you, key),
  write('You carried the key through the gate!!!'),nl,
  write('You have been struck by lighting'),nl,
  write('You are now dead. Game Over.'),nl,
  retract(at(you,Loc)),
  assert(at(you,done)),
  !.
treasure :-
  at(treasure,Loc),
  at(you,Loc),
  write('There is a treasure here.'),nl,
  write('Congratulations, you win!'),nl,
  retract(at(you,Loc)),
  assert(at(you,done)),
  !.
/*
  But if you and the treasure are not in the same place, nothing
  happens.
*/
treasure.

/*
  If you and the key are at the same place, you can pick it up but only if you havne't already.
*/

/*if you have the key you can't pick it up again*/
key :-
  has(you,key),
  at(key,Loc),
  at(you,Loc),
  !.
/*in same place as key but dont currently possess it so you can pick it up*/
key :-
  at(key,Loc),
  at(you,Loc),  
  retract(near(you, nothing)),
  assert(near(you, key)),
  write('There is a key here. (p)ickup'),nl,
  !.

key :-
  at(key,Loc),
  at(you,Loc),  
  assert(near(you, key)),
  write('There is a key here. (p)ickup'),nl,
  !.
/*not in the same location as key so not near key*/
key :-
  at(key,Loc),
  not(at(you,Loc)),
  near(you, key),
  retract(near(you, key)),
  assert(near(you, nothing)),
  !.
/*
  But if you and the key are not in the same place, nothing
  happens.
*/
key.



/*
  If you and the sword are at the same place, you can pick it up but only if you havne't already.
*/

/*if you have the sword you can't pick it up again*/
sword :-
  has(you,sword),
  at(sword,Loc),
  at(you,Loc),
  !.
/*in same place as key but dont currently possess it so you can pick it up*/
sword :-
  at(sword,Loc),
  at(you,Loc),
  write('There is a sword here. (p)ickup'),nl,
  retract(near(you, nothing)),
  assert(near(you, sword)),
  !.
/*not in the same location as key so not near key*/
sword :-
  at(sword,Loc),
  not(at(you,Loc)),
  near(you, sword),
  retract(near(you, sword)),
  assert(near(you, nothing)),
  !.
/*
  But if you and the key are not in the same place, nothing
  happens.
*/
sword.


/*
  If you are at the gate, you must unlock it.
*/
gate :-
  at(you,gate),
  has(you, key),
  write('You must unlock the gate. (u)nlock'),nl,  
  !.
gate :-
  at(you,gate),
  near(you, key),
  write('You have to pick up the key to unlock the gate'),nl,
  !.
gate :-
  at(you,gate),
  write('You dont have a key you cannot unlock the gate'),nl,
  retract(at(you,gate)),
  assert(at(you,done)),
  !.
/*
  But if you are not at the gate nothing happens.
*/
gate.

/*
  If you are at the cliff, you fall off and die.
*/
cliff :-
  at(you,cliff),
  write('You fall off and die.'),nl,
  retract(at(you,cliff)),
  assert(at(you,done)),
  !.
/*
  But if you are not at the cliff nothing happens.
*/
cliff.

/*
  Main loop.  Stop if player won or lost.
*/
main :-
  at(you,done),
  write('Thanks for playing.'),nl,
  !.
/*
  Main loop. Not done, so get a move from the user and make it. Then run
  all our special behaviors. Then repeat.
*/
main :-
  report,
  write('Next move -- '),
  read(Move),
  call(move(Move)),
  ogre,
  treasure,
  cliff,
  key,
  gate,
  sword,
  main.

/*
  This is the starting point for the game. We assert the initial
  conditions, print an initial report, then start the main loop.
*/
go :-
  retractall(at(_,_)), % clean up from previous runs if needed
  assert(at(you,valley)),
  assert(has(you, nothing)),
  assert(near(you, nothing)),
  assert(at(ogre,maze(3))),
  assert(at(key,maze(2))),
  assert(at(sword,maze(1))),
  assert(gateStatus(locked)),
  assert(at(treasure,mountaintop)),
  write('This is an adventure game.'),nl,
  write('Legal moves are (l)eft, (r)ight, or (f)orward.'),nl,nl,
  main,
  !.
